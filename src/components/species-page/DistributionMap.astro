---
import { getWorldGeoJson } from "../../../db/country_data";
import {
  splitCountryDistribution,
  // countryListToJson,
} from "../../scripts/species_map";
import SpeciesDistributionMap from "../maps/SpeciesDistributionMap";
import cntl from "cntl";

const { countries, extendClass } = Astro.props;

const countryList = splitCountryDistribution(countries ?? "");
const worldGeoJson = getWorldGeoJson();

const emptyDistribution =
  countryList.known.length === 0 && countryList.predicted.length === 0;

const hasPredictedDistribution = countryList.predicted.length > 0;

const mapContainerClasses = cntl`
  bg-spectra-100 
  dark:bg-spectra-900 
  rounded-xl 
  p-4 
  my-2
  ${extendClass}
`;

const titleClasses = cntl`
  text-lg 
  md:text-xl 
  font-semibold
`;

const captionTextClasses = cntl`
  text-spectra-800 
  dark:text-spectra-100 
  text-sm 
  mb-4
  ${emptyDistribution ? "hidden" : ""}
`;

const emptyTextClasses = cntl`
  text-sm 
  text-spectra-800 
  dark:text-spectra-200
  mt-4
`;
---

<div class={mapContainerClasses}>
  <h2 class={titleClasses}>Country distribution map</h2>
  <h3 class={captionTextClasses}>
    The map below provides a general overview. Most species inhabit only
    specific regions within countries. {
      hasPredictedDistribution && (
        <span>
          Known distribution is shown in green and predicted distribution is in
          yellow.
        </span>
      )
    }
    Hover over the highlighted regions to see the country name.
  </h3>
  {
    emptyDistribution ? (
      <p class={emptyTextClasses}>No distribution data available.</p>
    ) : (
      <SpeciesDistributionMap
        client:load
        distribution={countries ?? ""}
        world={worldGeoJson}
      />
    )
  }
</div>
